{"version":3,"sources":["uni-app:///main.js","webpack:///D:/UNIAPP/goodPrinceServer/pages/shop/QRCode.vue?0202","webpack:///D:/UNIAPP/goodPrinceServer/pages/shop/QRCode.vue?bf31","webpack:///D:/UNIAPP/goodPrinceServer/pages/shop/QRCode.vue?c9f0","webpack:///D:/UNIAPP/goodPrinceServer/pages/shop/QRCode.vue?c2da","uni-app:///pages/shop/QRCode.vue","webpack:///D:/UNIAPP/goodPrinceServer/pages/shop/QRCode.vue?f788","webpack:///D:/UNIAPP/goodPrinceServer/pages/shop/QRCode.vue?2941"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,8F;AACAA,UAAU,CAACC,eAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA+H;AAC/H;AAC0D;AACL;AACsC;;;AAG3F;AAC0K;AAC1K,gBAAgB,oLAAU;AAC1B,EAAE,4EAAM;AACR,EAAE,6FAAM;AACR,EAAE,sGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,iGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAAsoB,CAAgB,mpBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACqB1pB,+E;;;;AAIA,U;AACA;AACA;AACA,wBADA,EADA;;AAIA,MAJA,kBAIA;AACA;AACA;AACA,kBAFA;AAGA,aAHA,EAGA;AACA,eAJA,EAIA;AACA,iBALA,EAKA;AACA,yBANA,EAMA;AACA,cAPA,EAOA;AACA,kBARA,EAQA;AACA,WATA,EASA;AACA,kBAVA,EAUA;AACA,oBAXA,EAWA;AACA,aAZA,EAYA;;AAEA;AACA,gBAfA;AAgBA,gBAhBA;AAiBA,4DAjBA,EAiBA;AACA,eAlBA,EAkBA;AACA,eAnBA,EAmBA;AACA,oBApBA,EAoBA;AACA,sBArBA,EAqBA;AACA,qBAtBA;AAuBA,gCAvBA,EAuBA;AACA,+BAxBA,EAwBA;AACA,qCAzBA,EAyBA;AACA,iCA1BA,CA0BA;AA1BA;AA4BA,GAjCA;AAkCA,QAlCA,oBAkCA;AACA;AACA;AACA;AACA;;AAEA;AACA,GAzCA;AA0CA,SA1CA,qBA0CA;AACA;;AAEA,GA7CA;AA8CA;AACA,aADA,uBACA;AACA;AACA;AACA,0BADA;AAEA;AACA;AACA,yBADA;AAEA,oBAFA;;AAIA;AACA,YADA,CACA;AACA;AACA,SAHA,EAGA,KAHA,CAGA;AACA;AACA,SALA;;AAOA;AACA,OAfA;AAgBA,KAnBA;AAoBA,YApBA,oBAoBA,EApBA,EAoBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA3BA;AA4BA,OA5BA,eA4BA,GA5BA,EA4BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAxCA;AAyCA;AACA,iBA1CA,yBA0CA,CA1CA,EA0CA;AACA;AACA;AACA,OAFA,MAEA;AACA;AACA;AACA,KAhDA;AAiDA,aAjDA,qBAiDA,CAjDA,EAiDA;AACA;AACA;AACA,eADA,mBACA,GADA,EACA;AACA;AACA;AACA,6CADA;AAEA,qBAFA,qBAEA;AACA;AACA;AACA;AACA,eANA;AAOA,kBAPA,kBAOA;AACA;AACA;AACA,8BADA;AAEA,sCAFA;;AAIA,eAbA;;AAeA,WAhBA,MAgBA;AACA;AACA;AACA,SArBA;;AAuBA,KA1EA;AA2EA;AACA;AACA;AACA;AACA,sBADA;AAEA,uBAFA;AAGA,oBAHA;;AAKA;AACA;AACA;AACA,0BADA;AAEA;AACA;AACA,2BADA;AAEA,sBAFA;;AAIA;AACA,8BADA;AAEA;AACA;AACA;AACA,4CADA;AAEA;AACA;AACA,mCADA;AAEA,qCAFA;;AAIA,mBAPA;AAQA;AACA;AACA,mCADA;AAEA,kCAFA;;AAIA,mBAbA;;AAeA;AACA,aApBA;AAqBA;AACA;AACA,4BADA;AAEA,6BAFA;AAGA,0BAHA;;AAKA,aA3BA;AA4BA;AACA;AACA,aA9BA;;;AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,SAnEA;AAoEA;AACA;AACA,SAtEA;;AAwEA,KA7JA;AA8JA,gBA9JA,0BA8JA;AACA;AACA,+BADA;AAEA,mBAFA;;AAIA,KAnKA;AAoKA,YApKA,sBAoKA;AACA;AACA,mBAFA,GAEA,eAFA;AAGA,mBAHA,GAGA,aAHA;AAIA,mBAJA,GAIA,eAJA,EAIA;AACA,yBALA,GAKA,CALA,EAKA;AALA,yCAMA;AACA,sCADA,GANA,QAMA,QANA;;AASA;AACA,uCADA,GATA,SASA,OATA;AAWA;AACA,iBAZA,GAYA,iCAZA;AAaA,iBAbA,GAaA,+BAbA;AAcA,oBAdA,GAcA,aAdA;AAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,+CAzBA,CAyBA;AACA,6DA1BA,CA0BA;AACA;AACA;AACA;AACA,sDA9BA,CA8BA;AACA,kDA/BA,CA+BA;AACA;AACA,6BAjCA,GAiCA,CAjCA,EAiCA;AACA,0BAlCA,GAkCA,cAlCA,EAkCA;AACA,oBAnCA,GAmCA,CAnCA;AAoCA,iBApCA,GAoCA,CApCA,eAoCA,sBApCA;AAqCA,yEArCA;AAsCA,gCAtCA;AAuCA,2CAvCA;AAwCA;AACA;AACA;AACA;AACA,uBA5CA;;;AA+CA;AACA;AACA;AACA;AACA,uBAnDA;;AAqDA;AACA;AACA;AACA,iBAxDA,QAoCA,GApCA;;AA0DA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,mBAJA;AAKA,iBANA,EAMA,gCANA,EAlEA;;AA0EA,KA9OA;AA+OA,gBA/OA;;AAiPA,kOADA,MACA,QADA,MACA;AACA;AACA;AACA,+BADA;AAEA;AACA;AACA,qBAJA;AAKA,wBALA,gBAKA,GALA,EAKA;AACA;AACA,qBAPA;;AASA,iBAVA,CADA;AAYA,KA7PA;AA8PA,eA9PA,yBA8PA;AACA;AACA;AACA,4BADA;AAEA,+CAFA;AAGA;;AAEA,gBAFA;AAGA,eAHA,CAEA,MAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aARA,MAQA;AACA;AACA;AACA,8CADA,GACA,MADA,GACA,8BADA,EACA,CADA;AAEA;AACA;AACA,SAxBA;AAyBA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,oEADA;AAEA,sCAFA;AAGA,wBAHA;AAIA,6BAJA;AAKA;AACA,0CADA;AAEA,mDAFA,EALA;;AASA;AACA,uCADA;AAEA,wCAFA;AAGA,qCAHA,EATA;;AAcA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAtBA;AAuBA,oBAvBA,sBAuBA;AACA;AACA,aAzBA;AA0BA,gBA1BA,gBA0BA,CA1BA,EA0BA;AACA;AACA,aA5BA;;;;;AAiCA,SAjEA;AAkEA,UAlEA;AAmEA,KAnUA,EA9CA,E;;;;;;;;;;;;;AC1BA;AAAA;AAAA;AAAA;AAA+rC,CAAgB,ipCAAG,EAAC,C;;;;;;;;;;;ACAntC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/shop/QRCode.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/shop/QRCode.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./QRCode.vue?vue&type=template&id=1ac44d7e&scoped=true&\"\nvar renderjs\nimport script from \"./QRCode.vue?vue&type=script&lang=js&\"\nexport * from \"./QRCode.vue?vue&type=script&lang=js&\"\nimport style0 from \"./QRCode.vue?vue&type=style&index=0&id=1ac44d7e&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"1ac44d7e\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/shop/QRCode.vue\"\nexport default component.exports","export * from \"-!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./QRCode.vue?vue&type=template&id=1ac44d7e&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./QRCode.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./QRCode.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"container\">\r\n\t\t<view class=\"canvas-section\">\r\n\t\t\t<canvas canvas-id=\"myCanvas\" :style=\"{ width: canvasW + 'px', height: canvasH + 'px' }\" @click.stop=\"previewImage\"></canvas>\r\n\t\t</view>\r\n\r\n\t\t<view class=\"btn-section\" v-if=\"finished\">\r\n\t\t\t<button v-if=\"openSettingBtnHidden\" type=\"default\" class=\"cu-btn download-btn\" @click=\"saveImage\">下载到本地</button>\r\n\t\t\t<button v-else type=\"default\" class=\"cu-btn download-btn\" open-type=\"openSetting\" @opensetting=\"handleSetting\">下载到本地</button>\r\n\t\t</view>\r\n\r\n\t\t<!-- 生成普通二维码 -->\r\n\t\t<!-- <view v-show=\"!finished\" class=\"code_wrap\">\r\n\t\t\t<tki-qrcode v-if=\"ifShow\" cid=\"qrcode1\" ref=\"qrcode\" :val=\"val\" :size=\"size\" :unit=\"unit\" :icon=\"icon\" :iconSize=\"iconsize\"\r\n\t\t\t :pdground=\"pdground\" :lv=\"lv\" :onval=\"onval\" :loadMake=\"loadMake\" :usingComponents=\"true\" @result=\"qrR\" />\r\n\t\t</view> -->\r\n\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tbase64ToPath\r\n\t} from '@/components/image-tools/index.js'\r\n\timport tkiQrcode from '@/components/tki-qrcode/tki-qrcode.vue'\r\n\tvar _this;\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\ttkiQrcode\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\t/* qr */\r\n\t\t\t\tifShow: true,\r\n\t\t\t\tval: '', // 要生成的二维码值\r\n\t\t\t\tsize: 200, // 二维码大小\r\n\t\t\t\tunit: 'upx', // 单位\r\n\t\t\t\tpdground: '#F96D4E', // 角标色\r\n\t\t\t\ticon: '', // 二维码图标\r\n\t\t\t\ticonsize: 40, // 二维码图标大小\r\n\t\t\t\tlv: 3, // 二维码容错级别 ， 一般不用设置，默认就行\r\n\t\t\t\tonval: false, // val值变化时自动重新生成二维码\r\n\t\t\t\tloadMake: true, // 组件加载完成后自动生成二维码\r\n\t\t\t\tsrc: '', // 二维码生成后的图片地址或base64\r\n\r\n\t\t\t\t/* canvas */\r\n\t\t\t\tcanvasW: 0,\r\n\t\t\t\tcanvasH: 0,\r\n\t\t\t\timgSrc: \"https://wxhyx-cdn.aisspc.cn/static/qr_bg.png\", // 背景图\r\n\t\t\t\tTitle: \"\", // 店铺名\r\n\t\t\t\tQrSrc: \"\", //太阳码\r\n\t\t\t\tLineType: true, //标题显示行数\t\t（注超出2行显示会导致画布布局絮乱）\r\n\t\t\t\ttempFilePath: [], // 海报\r\n\t\t\t\tfinished: false,\r\n\t\t\t\topenSettingBtnHidden: true, //是否授权\r\n\t\t\t\tcanvasToImageFileError: 1, // 绘制最终展示海报时的错误次数\r\n\t\t\t\tcanvasToImageFileDelayTime: 200, // 绘制最终展示海报时的延时\r\n\t\t\t\tcanvasToImageFileQuality: 1, // 绘制最终展示海报时的画质\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tconst shopInfo = this.$db.get(\"shopInfo\");\r\n\t\t\tthis.val = `https://wxhyx.aisspc.cn?id=${shopInfo.id}`\r\n\t\t\t// console.log(\"二维码链接:\", this.val)\r\n\t\t\tthis.Title = shopInfo.shop_title;\r\n\r\n\t\t\tthis.getErCode();\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\t_this = this;\r\n\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tgetErCode() {\r\n\t\t\t\tconst shopInfo = this.$db.get(\"shopInfo\");\r\n\t\t\t\tthis.$http.getErCode({\r\n\t\t\t\t\tscene: shopInfo.id\r\n\t\t\t\t}, res => {\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\ttitle: \"加载中...\",\r\n\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\tbase64ToPath(res)\r\n\t\t\t\t\t\t.then(path => {\r\n\t\t\t\t\t\t\t_this.QrSrc = path\r\n\t\t\t\t\t\t}).catch(error => {\r\n\t\t\t\t\t\t\tconsole.warn(error)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t_this.OnCanvas();\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\ttoBuffer(ab) {\r\n\t\t\t\tvar buf = new Buffer(ab.byteLength);\r\n\t\t\t\tvar view = new Uint8Array(ab);\r\n\t\t\t\tfor (var i = 0; i < buf.length; ++i) {\r\n\t\t\t\t\tbuf[i] = view[i];\r\n\t\t\t\t}\r\n\t\t\t\treturn buf;\r\n\t\t\t},\r\n\t\t\tqrR(res) {\r\n\t\t\t\t// this.src = res\r\n\t\t\t\t// _this.QrSrc = res\r\n\t\t\t\tconsole.log(\"res\", res)\r\n\t\t\t\t// base64ToPath(res)\r\n\t\t\t\t//   .then(path => {\r\n\t\t\t\t//     console.log(\"path\",path)\r\n\t\t\t\t// \t _this.QrSrc = path\r\n\t\t\t\t//   }).catch(error => {\r\n\t\t\t\t//     console.warn(error)\r\n\t\t\t\t//   })\r\n\t\t\t\t// _this.OnCanvas();\r\n\t\t\t},\r\n\t\t\t//微信小程序保存到相册\r\n\t\t\thandleSetting(e) {\r\n\t\t\t\tif (!e.detail.authSetting['scope.writePhotosAlbum']) {\r\n\t\t\t\t\t_this.openSettingBtnHidden = false;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_this.openSettingBtnHidden = true;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tsaveImage(e) {\r\n\t\t\t\t//获取相册授权\r\n\t\t\t\tuni.getSetting({\r\n\t\t\t\t\tsuccess(res) {\r\n\t\t\t\t\t\tif (!res.authSetting['scope.writePhotosAlbum']) {\r\n\t\t\t\t\t\t\tuni.authorize({\r\n\t\t\t\t\t\t\t\tscope: 'scope.writePhotosAlbum',\r\n\t\t\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\t\t\t//这里是用户同意授权后的回调\r\n\t\t\t\t\t\t\t\t\t_this.saveImgToLocal();\r\n\t\t\t\t\t\t\t\t\tconsole.log(\"相册授权成功\")\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\tfail() { //这里是用户拒绝授权后的回调\r\n\t\t\t\t\t\t\t\t\t_this.openSettingBtnHidden = false;\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\t\t\t\t\ttitle: \"相册授权失败,请重试!\"\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} else { //用户已经授权过了\r\n\t\t\t\t\t\t\t_this.saveImgToLocal();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tsaveImgToLocal: function(e) {\r\n\t\t\t\tvar tempFilePaths = _this.tempFilePath[0]\r\n\t\t\t\tif (!tempFilePaths) {\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\ttitle: \"请重试!\",\r\n\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tuni.showActionSheet({\r\n\t\t\t\t\titemList: ['保存图片'],\r\n\t\t\t\t\tsuccess: sheetRes => {\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle: \"保存中...\",\r\n\t\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tuni.downloadFile({\r\n\t\t\t\t\t\t\turl: tempFilePaths,\r\n\t\t\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t\t\tif (res.errMsg == \"downloadFile:ok\") {\r\n\t\t\t\t\t\t\t\t\tuni.saveImageToPhotosAlbum({\r\n\t\t\t\t\t\t\t\t\t\tfilePath: res.tempFilePath,\r\n\t\t\t\t\t\t\t\t\t\tsuccess: function() {\r\n\t\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: \"保存成功\",\r\n\t\t\t\t\t\t\t\t\t\t\t\ticon: \"success\"\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\tfail: function() {\r\n\t\t\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: \"保存失败\",\r\n\t\t\t\t\t\t\t\t\t\t\t\ticon: \"none\"\r\n\t\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ticon: \"none\",\r\n\t\t\t\t\t\t\t\t\ttitle: \"请重试!\",\r\n\t\t\t\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcomplete: () => {\r\n\t\t\t\t\t\t\t\t// uni.hideLoading()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t// uni.saveFile({\r\n\t\t\t\t\t\t// \ttempFilePath: tempFilePaths,\r\n\t\t\t\t\t\t// \tsuccess: function(saveRes) {\r\n\t\t\t\t\t\t// \t\tif (saveRes.errMsg == \"saveFile:ok\") {\r\n\t\t\t\t\t\t// \t\t\tuni.saveImageToPhotosAlbum({\r\n\t\t\t\t\t\t// \t\t\t\tfilePath: saveRes.savedFilePath,\r\n\t\t\t\t\t\t// \t\t\t\tsuccess: function() {\r\n\t\t\t\t\t\t// \t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t// \t\t\t\t\t\ttitle: \"保存成功\",\r\n\t\t\t\t\t\t// \t\t\t\t\t\ticon: \"success\"\r\n\t\t\t\t\t\t// \t\t\t\t\t});\r\n\t\t\t\t\t\t// \t\t\t\t},\r\n\t\t\t\t\t\t// \t\t\t\tfail: function() {\r\n\t\t\t\t\t\t// \t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t// \t\t\t\t\t\ttitle: \"保存失败\",\r\n\t\t\t\t\t\t// \t\t\t\t\t\ticon: \"none\"\r\n\t\t\t\t\t\t// \t\t\t\t\t});\r\n\t\t\t\t\t\t// \t\t\t\t}\r\n\t\t\t\t\t\t// \t\t\t});\r\n\t\t\t\t\t\t// \t\t}\r\n\t\t\t\t\t\t// \t},\r\n\t\t\t\t\t\t// \tfail: function(saveErr) {\r\n\t\t\t\t\t\t// \t\tconsole.log(\"save\", saveErr)\r\n\t\t\t\t\t\t// \t}\r\n\t\t\t\t\t\t// })\r\n\r\n\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: sheetErr => {\r\n\t\t\t\t\t\tconsole.log(sheetErr);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpreviewImage() {\r\n\t\t\t\tuni.previewImage({\r\n\t\t\t\t\turls: this.tempFilePath,\r\n\t\t\t\t\tcurrent: \"\",\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync OnCanvas() {\r\n\t\t\t\t_this.ctx = uni.createCanvasContext(\"myCanvas\", this);\r\n\t\t\t\tconst C_W = uni.upx2px(662), //canvas宽度\r\n\t\t\t\t\tC_P = uni.upx2px(0), //canvas Padding 间距\r\n\t\t\t\t\tC_Q = uni.upx2px(150); //二维码或太阳码宽高\r\n\t\t\t\tlet _strlineW = 0; //文本宽度\r\n\t\t\t\tlet _imgInfo = await _this.getImageInfo({\r\n\t\t\t\t\timgSrc: _this.imgSrc\r\n\t\t\t\t}); //背景图\r\n\t\t\t\tlet _QrCode = await _this.getImageInfo({\r\n\t\t\t\t\timgSrc: _this.QrSrc\r\n\t\t\t\t}); //二维码或太阳码\r\n\t\t\t\tlet r = [_imgInfo.width, _imgInfo.height];\r\n\t\t\t\tlet q = [_QrCode.width, _QrCode.height];\r\n\t\t\t\tlet imgW = C_W - C_P * 2;\r\n\t\t\t\tif (r[0] != imgW) {\r\n\t\t\t\t\tr[1] = Math.floor((imgW / r[0]) * r[1]);\r\n\t\t\t\t\tr[0] = imgW;\r\n\t\t\t\t}\r\n\t\t\t\tif (q[0] != C_Q) {\r\n\t\t\t\t\tq[1] = Math.floor((C_Q / q[0]) * q[1]);\r\n\t\t\t\t\tq[0] = C_Q;\r\n\t\t\t\t}\r\n\t\t\t\t_this.canvasW = C_W;\r\n\t\t\t\t_this.canvasH = r[1];\r\n\t\t\t\t_this.ctx.setFillStyle(\"#fff\"); //canvas背景颜色\r\n\t\t\t\t_this.ctx.fillRect(0, 0, C_W, _this.canvasH); //canvas画布大小\r\n\t\t\t\t//添加图片展示\r\n\t\t\t\t_this.ctx.drawImage(_imgInfo.path, C_P, C_P, r[0], r[1]);\r\n\t\t\t\t//设置文本\r\n\t\t\t\t_this.ctx.setFontSize(uni.upx2px(40)); //设置标题字体大小\r\n\t\t\t\t_this.ctx.setFillStyle(\"#F4E0AD\"); //设置标题文本颜色\r\n\t\t\t\t_this.ctx.setTextAlign(\"center\")\r\n\t\t\t\tlet _strLastIndex = 0; //每次开始截取的字符串的索引\r\n\t\t\t\tlet _strHeight = uni.upx2px(90); //绘制字体距离canvas顶部的初始高度\r\n\t\t\t\tlet _num = 1;\r\n\t\t\t\tfor (let i = 0; i < _this.Title.length; i++) {\r\n\t\t\t\t\t_strlineW += _this.ctx.measureText(_this.Title[i]).width;\r\n\t\t\t\t\tif (_strlineW > r[0]) {\r\n\t\t\t\t\t\tif (_num == 2 && _this.LineType) {\r\n\t\t\t\t\t\t\t//文字换行数量大于二进行省略号处理\r\n\t\t\t\t\t\t\t_this.ctx.fillText(_this.Title.substring(_strLastIndex, i - 8) + '...', C_W / 2, _strHeight);\r\n\t\t\t\t\t\t\t_strlineW = 0;\r\n\t\t\t\t\t\t\t_strLastIndex = i;\r\n\t\t\t\t\t\t\t_num++;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t_this.ctx.fillText(_this.Title.substring(_strLastIndex, i), C_W / 2, _strHeight);\r\n\t\t\t\t\t\t\t_strlineW = 0;\r\n\t\t\t\t\t\t\t_strHeight += 30;\r\n\t\t\t\t\t\t\t_strLastIndex = i;\r\n\t\t\t\t\t\t\t_num++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else if (i == _this.Title.length - 1) {\r\n\t\t\t\t\t\t_this.ctx.fillText(_this.Title.substring(_strLastIndex, i + 1), C_W / 2, _strHeight);\r\n\t\t\t\t\t\t_strlineW = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t//设置文本 end\r\n\r\n\t\t\t\t//添加二维码\r\n\t\t\t\t// _strHeight += uni.upx2px(20);\r\n\t\t\t\t_this.ctx.drawImage(_QrCode.path, C_W / 2 - q[0] * 2.2 / 2, uni.upx2px(184), q[0] * 2.2, q[1] * 2.2);\r\n\t\t\t\t//添加二维码 end\r\n\r\n\t\t\t\t//延迟后渲染至canvas上\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t_this.ctx.draw(true, (ret) => {\r\n\t\t\t\t\t\t_this.getNewImage();\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t_this.finished = true;\r\n\t\t\t\t\t});\r\n\t\t\t\t}, _this.canvasToImageFileDelayTime);\r\n\r\n\t\t\t},\r\n\t\t\tasync getImageInfo({\r\n\t\t\t\timgSrc\r\n\t\t\t}) {\r\n\t\t\t\treturn new Promise((resolve, errs) => {\r\n\t\t\t\t\tuni.getImageInfo({\r\n\t\t\t\t\t\tsrc: imgSrc,\r\n\t\t\t\t\t\tsuccess: function(image) {\r\n\t\t\t\t\t\t\tresolve(image);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tfail(err) {\r\n\t\t\t\t\t\t\terrs(err);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetNewImage() {\r\n\t\t\t\tconst _this = this\r\n\t\t\t\tuni.canvasToTempFilePath({\r\n\t\t\t\t\tcanvasId: \"myCanvas\",\r\n\t\t\t\t\tquality: _this.canvasToImageFileQuality,\r\n\t\t\t\t\tfail: (error) => {\r\n\t\t\t\t\t\tconst {\r\n\t\t\t\t\t\t\terrMsg\r\n\t\t\t\t\t\t} = error\r\n\t\t\t\t\t\t// 可能会有其他报错，还是拦截一下吧\r\n\t\t\t\t\t\tif (errMsg === 'canvasToTempFilePath:fail:create bitmap failed') {\r\n\t\t\t\t\t\t\t// 一次不行再试一遍 5次都不过就放弃吧\r\n\t\t\t\t\t\t\tif (_this.canvasToImageFileError <= 5) {\r\n\t\t\t\t\t\t\t\t// 错误次数+1\r\n\t\t\t\t\t\t\t\t_this.getNewImageCount += 1;\r\n\t\t\t\t\t\t\t\t// 延迟+100\r\n\t\t\t\t\t\t\t\t_this.canvasToImageFileDelayTime += 100;\r\n\t\t\t\t\t\t\t\t// 画质减去0.1\r\n\t\t\t\t\t\t\t\t_this.canvasToImageFileQuality -= 0.1;\r\n\t\t\t\t\t\t\t\t_this.getNewImage()\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// 错了这么多遍基本没救了\r\n\t\t\t\t\t\t\t\tconsole.error('[canvasToImageFile]×生成海报失败，尝试次数:' + _this.canvasToImageFileError + ',延迟:' +\r\n\t\t\t\t\t\t\t\t\t_this.canvasToImageFileDelayTime + ',画质:' + _this.canvasToImageFileQuality, e);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: (res) => {\r\n\t\t\t\t\t\t// console.log(res.tempFilePath);\r\n\t\t\t\t\t\t// this.tempFilePath.push(res.tempFilePath);\r\n\r\n\t\t\t\t\t\tconsole.log(\"res.tempFilePath\", res)\r\n\r\n\t\t\t\t\t\tlet userinfo = this.$db.get(\"userinfo\") || \"\";\r\n\t\t\t\t\t\tuni.uploadFile({\r\n\t\t\t\t\t\t\turl: 'https://wxhyx.aisspc.cn/addons/qiniu/index/upload',\r\n\t\t\t\t\t\t\tfilePath: res.tempFilePath,\r\n\t\t\t\t\t\t\tname: 'file',\r\n\t\t\t\t\t\t\tfileType: 'image',\r\n\t\t\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t\t\t'Accept': 'application/json',\r\n\t\t\t\t\t\t\t\t'Content-Type': 'multipart/form-data',\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tformData: {\r\n\t\t\t\t\t\t\t\t'method': 'images.upload',\r\n\t\t\t\t\t\t\t\t'upfile': res.tempFilePath,\r\n\t\t\t\t\t\t\t\t'token': userinfo.token\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t//formData:{},传递参数\r\n\t\t\t\t\t\t\tsuccess: (uploadFileRes) => {\r\n\t\t\t\t\t\t\t\t// src=\"https://wxhyx-cdn.aisspc.cn/static/shopCenter_icon_b.png\"\r\n\t\t\t\t\t\t\t\tconst backUpload = JSON.parse(uploadFileRes.data);\r\n\t\t\t\t\t\t\t\tconst url = `https://wxhyx-cdn.aisspc.cn${backUpload.data.url}`\r\n\t\t\t\t\t\t\t\tthis.tempFilePath.push(url);\r\n\t\t\t\t\t\t\t\tconsole.log(\"上传图片\", this.tempFilePath)\r\n\t\t\t\t\t\t\t\t//自定义操作\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tcomplete() {\r\n\t\t\t\t\t\t\t\t//console.log(\"this is headimg\"+this.headimg)   \r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\tfail(e) {\r\n\t\t\t\t\t\t\t\tconsole.log(\"this is errormes \")\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t});\r\n\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t@import '@/style/mixin.scss';\r\n\r\n\t.container {\r\n\t\tmin-height: 100vh;\r\n\t\tbackground-image: url(\"https://wxhyx-cdn.aisspc.cn/static/cavas_bg.png\");\r\n\t\tbackground-size: 100% 100%;\r\n\t\tpadding-bottom: 80rpx;\r\n\t}\r\n\r\n\t.code_wrap {\r\n\t\topacity: 0;\r\n\t}\r\n\r\n\t.canvas-section {\r\n\t\tpadding: 80rpx 44rpx 0;\r\n\t}\r\n\r\n\t.btn-section {\r\n\t\t@include flexX;\r\n\t\t@include flexJ;\r\n\t\tmargin-top: 50rpx;\r\n\r\n\t\t.download-btn {\r\n\t\t\twidth: 480rpx;\r\n\t\t\theight: 100rpx;\r\n\t\t\tbackground-color: #FF544C;\r\n\t\t\tcolor: #fff;\r\n\t\t\tfont-size: 32rpx;\r\n\t\t\tfont-weight: 500;\r\n\t\t\tborder-radius: 50rpx;\r\n\t\t}\r\n\t}\r\n</style>\r\n","import mod from \"-!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./QRCode.vue?vue&type=style&index=0&id=1ac44d7e&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../itools/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./QRCode.vue?vue&type=style&index=0&id=1ac44d7e&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1597211856249\n      var cssReload = require(\"D:/itools/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}